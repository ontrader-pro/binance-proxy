<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>OnTrader Index Panel - 5m</title>
  <style>
    body { background: #101729; color: #fff; font-family: sans-serif; margin:0; }
    h1 { color: #25f0ff; text-align: center; margin-top:16px; }
    #panel { padding: 10px; }
    .loading { text-align:center; padding:40px; color:#888; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 18px;}
    th, td { border: 1px solid #333; padding: 5px 7px; text-align: center; }
    th { background: #16213c; color: #25f0ff; }
    .high { color: #45f877; font-weight: bold; }
    .low { color: #ff4444; font-weight: bold; }
    .mid { color: orange; }
    .bullish { background: rgba(0,255,0,0.11);}
    .bearish { background: rgba(255,0,0,0.09);}
    #error { color: #ff6f6f; text-align: center; font-weight: bold; }
  </style>
</head>
<body>
  <h1>OnTrader Index Panel <span style="font-size:0.6em;">(5m)</span></h1>
  <div id="panel"><div class="loading">Cargando datos…</div></div>
  <div id="error"></div>
<script>
const ENDPOINT = "https://binance-proxy-ihaub8pjl-ontraders-projects.vercel.app/api/binance";
function makeTable(rows, header=["Símbolo","Últ. Precio","Score","Fase"]) {
  let html = `<table><thead><tr>${header.map(h=>`<th>${h}</th>`).join('')}</tr></thead><tbody>`;
  for(const row of rows) {
    const cls = row.score >= 8 ? 'high' : row.score <= 3 ? 'low' : 'mid';
    html += `<tr class="${row.phase.includes('Bullish') ? 'bullish': row.phase.includes('Bearish') ? 'bearish':''}">
      <td>${row.symbol}</td>
      <td>${row.lastPrice}</td>
      <td class="${cls}">${row.score.toFixed(2)}</td>
      <td>${row.phase}</td>
    </tr>`;
  }
  return html+"</tbody></table>";
}
async function main() {
  document.getElementById('panel').innerHTML = '<div class="loading">Cargando ranking…</div>';
  document.getElementById('error').textContent = '';
  try {
    let res = await fetch(ENDPOINT);
    let proxyResp = await res.json();
    if (!proxyResp.success || !Array.isArray(proxyResp.data)) {
      throw new Error(proxyResp.error || "Formato de respuesta del proxy no válido");
    }
    let results = proxyResp.data;
    // Rankings
    const topBullish = results.slice().sort((a,b)=>b.score-a.score).slice(0,10);
    const topBearish = results.slice().sort((a,b)=>a.score-b.score).slice(0,10);
    // Renderiza todo
    document.getElementById('panel').innerHTML =
      `<h3>Top 10 Bullish</h3>${makeTable(topBullish)}` +
      `<h3>Top 10 Bearish</h3>${makeTable(topBearish)}`;
  } catch(e) {
    document.getElementById('panel').innerHTML = '';
    document.getElementById('error').textContent = 'Error cargando datos: ' + (e.message||e);
    console.error("ERROR GLOBAL:", e);
  }
}
main();
setInterval(main, 120000);
</script>
</body>
</html>
